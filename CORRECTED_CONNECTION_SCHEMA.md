# üîó –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π n8n Workflow

## ‚ö†Ô∏è **–í–ê–ñ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**

–í —Å–æ–∑–¥–∞–Ω–Ω–æ–º JSON —Ñ–∞–π–ª–µ –µ—Å—Ç—å —É–∑–µ–ª `check-subscription` (Execute Workflow), –∫–æ—Ç–æ—Ä—ã–π **–ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω** –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø–æ—Ç–æ–∫—É. –≠—Ç–æ –±—ã–ª –∑–∞–¥–µ–ª –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

## üóëÔ∏è **–£–∑–ª—ã –∫ —É–¥–∞–ª–µ–Ω–∏—é:**

### `check-subscription` - Execute Workflow 
- **–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ workflow
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–ª—Å—è –¥–ª—è –≤—ã–∑–æ–≤–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å—É–±–≤–æ—Ä–∫—Ñ–ª–æ—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å –∏–∑ workflow, —Ç–∞–∫ –∫–∞–∫ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `subscription-checker`

---

## üìã **–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É–∑–ª–æ–≤ (21 –Ω–æ–¥–∞)**

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–¥—ã | –¢–∏–ø | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|---|
| 1 | `telegram-trigger` | Trigger | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Telegram Trigger - –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ |
| 2 | `message-parser` | Code | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Message Parser - –ø–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π |
| 3 | `message-router` | Switch | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Message Router - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è |
| 4 | `subscription-checker` | Code | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Subscription Checker - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ |
| 5 | `start-response` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Start Response - –æ—Ç–≤–µ—Ç –Ω–∞ /start |
| 6 | `subscription-response` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Subscription Response - –æ—Ç–≤–µ—Ç –Ω–∞ /tarif |
| 7 | `payment-response` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Payment Response - –æ—Ç–≤–µ—Ç –Ω–∞ /oplata |
| 8 | `help-response` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Help Response - –æ—Ç–≤–µ—Ç –Ω–∞ /help |
| 9 | `fallback-response` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Fallback Response - –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ |
| 10 | `download-voice-file` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Download Voice File - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞ |
| 11 | `transcribe-voice` | OpenAI | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Transcribe Voice - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è |
| 12 | `update-transcribed-message` | Set | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Update Message - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ |
| 13 | `subscription-gate` | If | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Subscription Gate - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è AI |
| 14 | `free-request-gate` | If | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Free Request Gate - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ |
| 15 | `ai-realtor-agent` | AI Agent | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | AI Realtor Agent - –æ—Å–Ω–æ–≤–Ω–æ–π –ò–ò |
| 16 | `openai-chat-model` | OpenAI Model | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | OpenAI Chat Model - –º–æ–¥–µ–ª—å –ò–ò |
| 17 | `postgres-memory` | Memory | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Postgres Memory - –ø–∞–º—è—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤ |
| 18 | `knowledge-vector-store` | Vector Store | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Vector Store - –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π |
| 19 | `ai-response` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | AI Response - –æ—Ç–≤–µ—Ç –ò–ò |
| 20 | `limit-exceeded-response` | Telegram | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Limit Response - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç |
| 21 | `log-conversation` | Supabase | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Log Conversation - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| 22 | `update-request-counter` | Code | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Update Counter - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ |
| ~~23~~ | ~~`check-subscription`~~ | ~~Execute Workflow~~ | ‚ùå **–£–î–ê–õ–ò–¢–¨** | –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ workflow |

---

## üîÑ **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è check-subscription**

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏—Ç—å —É–∑–µ–ª (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `subscription-checker`
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º —Å—É–±–≤–æ—Ä–∫—Ñ–ª–æ—É
- –£–ø—Ä–æ—â–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–∫ —Å—É–±–≤–æ—Ä–∫—Ñ–ª–æ—É
–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—É–±–≤–æ—Ä–∫—Ñ–ª–æ—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:

```
message-router ‚Üí check-subscription ‚Üí subscription responses
```

**–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ:**
1. –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π workflow –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å `check-subscription` –º–µ–∂–¥—É `message-router` –∏ response handlers
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `workflowId` –≤ —É–∑–ª–µ

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ HTTP Request
–ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π API:

```javascript
// –í —É–∑–ª–µ check-subscription –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ HTTP Request
{
  "method": "POST",
  "url": "https://your-api.com/check-subscription",
  "body": {
    "user_id": "={{ $json.userId }}",
    "subscription_type": "premium"
  }
}
```

---

## ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ**

**–£–¥–∞–ª–∏—Ç–µ —É–∑–µ–ª `check-subscription`** –∏–∑ workflow, –ø–æ—Å–∫–æ–ª—å–∫—É:

1. ‚úÖ –û–Ω –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø–æ—Ç–æ–∫—É
2. ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `subscription-checker`
3. ‚úÖ –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
4. ‚úÖ –ò–∑–±–µ–∂–∏—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã

---

## üîó **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (28 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)**

–í—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö, –Ω–æ **–ë–ï–ó** —É–∑–ª–∞ `check-subscription`.

### –ò—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:
- **–£–∑–ª–æ–≤**: 21 (–≤–º–µ—Å—Ç–æ 22)
- **–°–æ–µ–¥–∏–Ω–µ–Ω–∏–π**: 28 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- **Main connections**: 25
- **AI connections**: 3

---

## üõ†Ô∏è **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é**

### –í n8n:
1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow
2. –ù–∞–π–¥–∏—Ç–µ —É–∑–µ–ª `Check Subscription` (Execute Workflow)
3. –£–¥–∞–ª–∏—Ç–µ –µ–≥–æ (–æ–Ω –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

### –í JSON —Ñ–∞–π–ª–µ:
–£–∑–µ–ª –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å - –æ–Ω –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø–æ—Ç–æ–∫—É.

---

**–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–º–µ—á–∞–Ω–∏–µ! –¢–µ–ø–µ—Ä—å —Å—Ö–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–±–æ—á–µ–º—É workflow.** üéØ