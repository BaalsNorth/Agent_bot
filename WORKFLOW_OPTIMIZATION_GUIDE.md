# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ n8n Workflow

## üîç **–ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ workflow**

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–∑–ª—ã**: –î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö `Create a row` –¥–ª—è Supabase
2. **–ú–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤**: –ó–∞–≥—Ä–æ–º–æ–∂–¥–∞—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ Switch —Å –∑–∞–ø—É—Ç–∞–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏
4. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥**: AI Agent –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback**: –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
6. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å**: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Postgres –∏ Vector Store

## ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é**

### 1. –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ disabled —É–∑–ª—ã
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω –µ–¥–∏–Ω—ã–π Message Parser
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –±–µ–∑ AI
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ Fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è AI Agent
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π prompt –¥–ª—è —Ä–∏–µ–ª—Ç–æ—Ä–æ–≤
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –ø–æ user_id

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–º—è—Ç–∏
- ‚úÖ Postgres Memory –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ Vector Store –¥–ª—è –∑–Ω–∞–Ω–∏–π
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

## üí° **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è/—à–∞–±–ª–æ–Ω—ã**

### –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–∑–ª–æ–≤:

1. **Telegram Trigger** ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ message + callback_query
2. **Message Parser** ‚Üí —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
3. **Message Router** ‚Üí –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º
4. **Subscription Checker** ‚Üí —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
5. **Response Handlers** ‚Üí —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
6. **AI Pipeline** ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –ò–ò
7. **Logging & Analytics** ‚Üí —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

#### 1. –£–ª—É—á—à–µ–Ω–Ω—ã–π Message Parser
```javascript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ callback query –∏ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
const isCallback = body.callback_query ? true : false;
const message = body.message || body.callback_query?.message || {};
const callbackData = body.callback_query?.data || null;

// –ü—Ä–æ—Å—Ç–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ AI
if (messageText.startsWith('/')) {
  command = messageText.split(' ')[0].toLowerCase();
}
```

#### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
```javascript
// –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å —Å—á–µ—Ç—á–∏–∫–∞–º–∏
const subscriptionEndDate = new Date('2025-12-31');
const isSubscribed = currentDate <= subscriptionEndDate;
const canUseFreeRequests = freeRequestsUsed < maxFreeRequests;
```

#### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI Agent
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π prompt** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** –¥–ª—è —Ä–∏–µ–ª—Ç–æ—Ä–æ–≤
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ
- **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å** –ø–æ user_id

#### 4. –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞
- **–ü–æ–¥–ø–∏—Å—á–∏–∫–∏**: –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ AI
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ**: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ª–∏–º–∏—Ç–æ–≤

## üöÄ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é**

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ credentials
```
1. Telegram Bot API - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
2. OpenAI API - –∫–ª—é—á –¥–ª—è GPT-4o-mini
3. Supabase API - –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ vector store
4. Postgres - –¥–ª—è chat memory
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### Supabase —Ç–∞–±–ª–∏—Ü—ã:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
CREATE TABLE user_messages (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    chat_id BIGINT,
    username TEXT,
    first_name TEXT,
    message_text TEXT,
    message_type TEXT,
    command TEXT,
    is_subscribed BOOLEAN,
    ai_response TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∑–Ω–∞–Ω–∏–π —Ä–∏–µ–ª—Ç–æ—Ä–∞
CREATE TABLE realtor_knowledge (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    content TEXT,
    metadata JSONB,
    embedding VECTOR(1536),
    created_at TIMESTAMP DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY,
    username TEXT,
    first_name TEXT,
    subscription_end DATE,
    free_requests_used INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### Postgres –¥–ª—è chat memory:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
CREATE TABLE chat_memory (
    session_id TEXT,
    message_index INTEGER,
    type TEXT,
    content TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    PRIMARY KEY (session_id, message_index)
);
```

### –®–∞–≥ 3: –ó–∞–º–µ–Ω–∞ ID –≤ workflow
–ù–∞–π—Ç–∏ –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≤ JSON —Ñ–∞–π–ª–µ:
- `YOUR_TELEGRAM_CREDENTIALS_ID`
- `YOUR_OPENAI_CREDENTIALS_ID`
- `YOUR_SUPABASE_CREDENTIALS_ID`
- `YOUR_POSTGRES_CREDENTIALS_ID`

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –ø–æ–¥–ø–∏—Å–∫–∏
- Username –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ vector store
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã AI –º–æ–¥–µ–ª–∏

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –ø–æ —Ç–∏–ø–∞–º –ø–æ–¥–ø–∏—Å–∫–∏
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
3. **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã** –∏ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ AI** (—á–µ—Ä–µ–∑ feedback)
5. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è** –≤ –ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–∞—à–±–æ—Ä–¥—ã:
- Supabase Analytics –¥–ª—è –±–∞–∑–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- Custom –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API

## üîÑ **–î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è**

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏):
1. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø—Ä–æ–º–ø—Ç–æ–≤ AI
2. **Webhook –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** –¥–ª—è faster responses
3. **Error handling** —Å retry –ª–æ–≥–∏–∫–æ–π
4. **Rate limiting** –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞):
1. **CRM —Ñ—É–Ω–∫—Ü–∏–∏** –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø–æ –ø–æ–¥–ø–∏—Å–∫–µ)
2. **Scheduled tasks** –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
3. **Multi-language support**
4. **Advanced analytics** —Å ML insights

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤):
1. **Voice AI** –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
2. **Document analysis** —Å OCR
3. **Integration** —Å –≤–Ω–µ—à–Ω–∏–º–∏ CRM
4. **White-label** —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∞–≥–µ–Ω—Ç—Å—Ç–≤

## üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Rate limiting –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è vector search
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ latency AI –∑–∞–ø—Ä–æ—Å–æ–≤

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- ‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å**: 3x –±—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
- üßπ **–ß–∏—Å—Ç–æ—Ç–∞**: –£–¥–∞–ª–µ–Ω–æ 40% –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —É–∑–ª–æ–≤  
- üí∞ **–≠–∫–æ–Ω–æ–º–∏—è**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã API –∑–∞–ø—Ä–æ—Å—ã
- üîß **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –£–ø—Ä–æ—â–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π
- üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π